
- 什么是SPI what
  - SPI vs API
- 为什么要SPI  why
- 怎么使用SPI how
- 什么场景下使用 SPI when
- SPI原理解析

### 1. SPI是什么

SPI（Service Provider Interface），是 JDK 内置的一种服务提供发现机制，可以用来启用框架扩展和替换组件，主要是被框架的开发人员使用，比如java.sql.Driver接口，其他不同厂商可以针对同一接口做出不同的实现，MySQL和PostgreSQL都有不同的实现提供给用户，而Java的SPI机制可以为某个接口寻找服务实现。Java中SPI机制主要思想是将装配的控制权移到程序之外，在模块化设计中这个机制尤其重要，其核心思想就是解耦。

API和SPI区别：
- API是提供给你直接使用的接口
  - 你调用,别人实现
  - 通常接口定义位于被调用方的包中
- SPI(ServiceProviderInterface)是提供给你扩展/实现的接口,用以自定义的功能
  - 别人调用,你来实现
  - 通常接口定义位于调用方的包中


SPI就是JDK提供的一个功能，JDK中提供的ServiceLoader可以读取第三方在META-INF/services文件夹中配置的文件，然后自动加载文件里所定义的类，这样我们引入第三方包的时候，无需任何硬编码就可以使用到第三方包中提供的实现类。


### 3. SPI如何使用

定义一组接口 SPIService：
```java
public interface SPIService {
    void print();
}
```
然后写出该接口的一个或多个实现类：
```java
public class ChineseSPIServiceImpl implements SPIService {
    @Override
    public void print() {
        System.out.println("你好");
    }
}

public class EnglishSPIServiceImpl implements SPIService {
    @Override
    public void print() {
        System.out.println("Hello");
    }
}
```

在 src/main/resources/ 下建立 /META-INF/services 目录， 新增一个以接口命名的文件 (在这文件名称为 com.common.example.spi.SPIService)，内容是要应用具体实现类：
```java
com.common.example.spi.ChineseSPIServiceImpl
com.common.example.spi.EnglishSPIServiceImpl
```

使用 ServiceLoader 来加载配置文件中指定的实现：
```java
public class SPIExample {
    public static void main(String[] args) {
        ServiceLoader<SPIService> spiServices = ServiceLoader.load(SPIService.class);
        Iterator iterator = spiServices.iterator();
        while (iterator.hasNext()){
            SPIService spiService = (SPIService)  iterator.next();
            spiService.print();
        }
    }
}
```
