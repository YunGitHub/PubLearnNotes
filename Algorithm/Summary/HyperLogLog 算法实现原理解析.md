https://mp.weixin.qq.com/s/MVxmH5r0tP6sQ9WKVLoDbw
https://mp.weixin.qq.com/s/4BC6iHUFGL4BjATmIiz-aA
https://mp.weixin.qq.com/s/9dtGe3d_mbbxW5FpVPDNow
https://mp.weixin.qq.com/s/9dtGe3d_mbbxW5FpVPDNow
https://mp.weixin.qq.com/s/Hz7O9XfCC2IGK8PcVTkICQ

https://zhuanlan.zhihu.com/p/77289303
http://content.research.neustar.biz/blog/hll.html
https://www.zhihu.com/question/514242765/answer/2333997473
https://www.jianshu.com/p/55defda6dcd2


## 1. 背景

大家在项目上可能会遇到过下面这些相同或者类似的需求：
- 统计一个APP的日活量（DAU）和月活量（MAU）。日活（月活）是指在一个统计日（统计月）之内，登录或者使用产品的不同用户数量，它是产品运营情况的重要指标之一，反映了用户的活跃度。
- 统计网站上各个网页的独立访客数，例如有些网页上面有阅读数。独立访客数需要对用户做去重，同一个用户多次访问只计算一次。

概括来说，这类需求就是去统计一个集合中不重复元素的个数。在数学上把一个集合不重复元素的个数称为集合的基数（cardinality，也有叫做势），这类问题可以称为基数统计问题。问题其实很简单，有很多常规的方法或数据结构去解决，例如：
- 集合Set：将所有元素存储在一个Set（可以用哈希表或树实现）中，利用Set对元素进行去重。该方法可以精确的计算出不重复元素的数量，由于需要存储实际的数据，在数据量较少时可行，但是数据量达到百万、千万甚至上亿时，会占用大量的内存。假设有1亿个不重复的元素，每个数据大小是4字节，那么使用Set结构至少需要内存 100000000∗4B=400MB。
- 位图 Bitmap：位图是一个大的bit数组，我们不需要去保存实际的元素，只需要用1bit来标识某个元素是否出现过，这样能够极大地节省内存。位图占用的内存和元素的值域有关，因为我们需要把值域映射到这个大的比特数组上。假设元素的值域是 [1,1亿]，那么采用位图需要的内存就是 100000000∗1bit / 8 ≈12MB 。该方法也能够精确的计算出不重复元素的数量，比起Set来说，内存占用确实减少很多，但是如果需要统计上千个模块或者业务的数据，那么内存消耗依然很大。
- 布隆过滤器Bloom filter：布隆过滤器类似于位图，也是一个大的bit数组，存储的数据通过多个哈希函数计算，映射到比特数组的多个bit中，进而判断一个元素是否在集合中。布隆过滤器具有一定的误判率，占用的内存比位图略小，和误判率有关，误判率越低，需要的内存越大。

上述这些方法在数据量较小的时候，都是可以有效的解决基数统计问题，但是当数据量较大的时候，这些方法占用的内存可能就无法接受了。

那么在海量数据的场景下，有什么方法去解决基数统计的问题呢？









参考：
- HyperLogLog 算法原理及其在 Redis 中的实现：https://mp.weixin.qq.com/s/MVxmH5r0tP6sQ9WKVLoDbw
