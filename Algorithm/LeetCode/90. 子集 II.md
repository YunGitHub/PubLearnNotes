### 1. 题目

[90. 子集 II](https://leetcode.cn/problems/subsets-ii/)

给定一个可能包含重复元素的整数数组 nums，返回该数组所有可能的子集（幂集）。

说明：解集不能包含重复的子集。

示例:
```
输入: [1,2,2]
输出:
[
  [2],
  [1],
  [1,2,2],
  [2,2],
  [1,2],
  []
]
```

### 2. 实现

核心点是如果跳过重复元素，当前元素与前一个元素相同，且前一个元素没有被选择，则跳过该元素。那如何判断是重复的前一个元素没有被访问过呢？首先先到的是通过 visited[i] 数组来标记每一个被访问过的元素。

### 2.1 实现一

通过 visited[i] 数组来判断第 i 个元素是否被访问过：
```java
public List<List<Integer>> subsetsWithDup(int[] nums) {
    List<List<Integer>> res = new ArrayList<>();
    // 是否访问过
    boolean[] visited = new boolean[nums.length];
    // 排序
    Arrays.sort(nums);
    backtrack(nums, new ArrayList<>(), res, visited, 0);
    return res;
}

// 回溯
private void backtrack(int[] nums, List<Integer> tmpList, List<List<Integer>> res, boolean[] visited, int start) {
    // 1. 无终止条件
    res.add(new ArrayList<>(tmpList));

    for (int i = start;i < nums.length;i++) {
        // 当前元素与前一个元素相同，且前一个元素没有被选择，则跳过该元素
        if (i > 0 && nums[i-1] == nums[i] && visited[i-1] == false) {
            continue;
        }
        tmpList.add(nums[i]);
        visited[i] = true;
        // 2. 递归函数
        backtrack(nums, tmpList, res, visited, i+1);
        // 回溯
        visited[i] = false;
        tmpList.remove(tmpList.size()-1);
    }
}
```

### 2.2 实现二

实现一中通过额外的存储空间来标识访问过的元素，我们能不能不占用额外的存储空间就能判断出？每一次选择一个元素时，如果当前元素下标 i 不是起始下标 start 就表示前一个元素没有被选择：
```java
public List<List<Integer>> subsetsWithDup(int[] nums) {
    List<List<Integer>> res = new ArrayList<>();
    // 排序
    Arrays.sort(nums);
    backtrack(nums, new ArrayList<>(), res, 0);
    return res;
}

// 回溯
private void backtrack(int[] nums, List<Integer> tmpList, List<List<Integer>> res, int start) {
    // 1. 无终止条件
    res.add(new ArrayList<>(tmpList));
    for (int i = start;i < nums.length;i++) {
        // 当前元素与前一个元素相同，且前一个元素没有被选择，则跳过该元素
        if (i != start && nums[i-1] == nums[i]) {
            continue;
        }
        tmpList.add(nums[i]);
        // 2. 递归函数
        backtrack(nums, tmpList, res, i+1);
        // 回溯
        tmpList.remove(tmpList.size()-1);
    }
}
```
